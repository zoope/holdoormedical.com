<!DOCTYPE html>
<html lang="en">
 
<head>
    <meta charset="UTF-8" />
    <title>THEOplayer Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
 
    <style>
        .panel {
            margin: 30px;
        }
    </style>
    <!-- THEOplayer library and css -->
    <script type="text/javascript"
        src="https://cdn.myth.theoplayer.com/6e45dd22-4af2-4f82-9454-3e64339cc260/THEOplayer.js"></script>
    <link rel="stylesheet" type="text/css"
        href="https://cdn.myth.theoplayer.com/6e45dd22-4af2-4f82-9454-3e64339cc260/ui.css" />
 
</head>
 
<body>
 
    <div class="theoplayer-container video-js theoplayer-skin vjs-16-9"></div>
 
    <div class="panel">
        <div>视频开始后每秒更新一次</div>
        <div id="codecs"></div>
        <div id="bandwidth"></div>
        <div id="currentBandwidthEstimate"></div>
        <div id="requestRTT"></div>
        <div id="videoSourceResolution"></div>
        <div id="playerResolution"></div>
        <div id="fps"></div>
        <div id="droppedFrames"></div>
        <div id="rebufferCount"></div>
        <div id="rebufferTime"></div>
    </div>
 
    <script>
        let timer = null, rebufferCount = 0, allRebufferTime = 0;
        const element = document.querySelector(".theoplayer-container");
        const player = new THEOplayer.Player(element, {
            libraryLocation: "https://cdn.myth.theoplayer.com/6e45dd22-4af2-4f82-9454-3e64339cc260",
            license: "sZP7IYe6T6ftCShL0DC_36z_Tu0_FSx1CDf-CSBZ36zz0ShL0SBk3SRc3lf6FOPlUY3zWokgbgjNIOf9fKaLCL5rCoPKFSxKTSb-3uCZTOk6ClhLFDB_CLhL0Lg63SXK0ZfVfK4_bQgZCYxNWoryIQXzImf90SCZ0LCo3uRi0u5i0Oi6Io4pIYP1UQgqWgjeCYxgflEc3lB_0le_0Sbo0la_FOPeWok1dDrLYtA1Ioh6TgV6UQ1gWtAVCYggb6rlWoz6FOPVWo31WQ1qbta6FOfJfgzVfKxqWDXNWG3ybojkbK3gflNWfGxEIDjiWQXrIYfpCoj-f6i6WQjlCDcEWt3zf6i6v6PUFOPLIQ-LflNWfK1zWDikfgzVfG3gWKxydDkibK4LbogqW6f9UwPkIYz"
        });
        player.source = {
            sources: [{
                "src": "https://cdn.theoplayer.com/video/elephants-dream/playlist-single-audio.m3u8",
                "type": "application/x-mpegurl",
                "lowLatency": false
            }],
        };
 
        (function () {
            let waitingTimescamp = null
            player.addEventListener('waiting', (e) => {
                console.log('waiting', e);
                rebufferCount++;
                waitingTimescamp = Date.now();
            })
 
            player.addEventListener('playing', (e) => {
                console.log('playing', e);
                if (waitingTimescamp) {
                    allRebufferTime += Date.now() - waitingTimescamp;
                }
                waitingTimescamp = null
            })
        })()
 
        player.videoTracks.addEventListener('addtrack', (addTrackEvent) => {
            const videoTrack = addTrackEvent.track;
            clearInterval(timer)
            timer = setInterval(() => {
                getInfo(player);
            }, 1000)
        });
 
        function getInfo(player) {
            document.querySelector('#codecs').innerText = `codecs: ${player.videoTracks[0].activeQuality && player.videoTracks[0].activeQuality.codecs}`
            document.querySelector('#bandwidth').innerText = `bandwidth: ${player.network.estimator.bandwidth}`
            document.querySelector('#currentBandwidthEstimate').innerText = `currentBandwidthEstimate: ${player.metrics.currentBandwidthEstimate}`
            document.querySelector('#requestRTT').innerText = `Request RTT: ${player.network.estimator.roundTripTime}`
            document.querySelector('#videoSourceResolution').innerText = `Video source resolution: ${player.videoWidth} × ${player.videoHeight}`
            document.querySelector('#playerResolution').innerText = `Player resolution: ${getComputedStyle(player.element).width} × ${getComputedStyle(player.element).height}`
            document.querySelector('#fps').innerText = `FPS: ${player.videoTracks[0].activeQuality && player.videoTracks[0].activeQuality.frameRate}`
            document.querySelector('#droppedFrames').innerText = `Dropped frames: ${player.metrics.droppedVideoFrames}`
            document.querySelector('#rebufferCount').innerText = `Rebuffer Count: ${rebufferCount}`
            document.querySelector('#rebufferTime').innerText = `Rebuffer Time: ${allRebufferTime}ms`
        }
 
    </script>
</body>
 
</html>